-- 创建用户表
CREATE TABLE users (
    user_id SERIAL PRIMARY KEY,
    username VARCHAR(50) NOT NULL UNIQUE,
    password VARCHAR(100) NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- 创建模板列表表
CREATE TABLE templates (
    template_id SERIAL PRIMARY KEY,
    user_id INTEGER NOT NULL,
    template_name VARCHAR(100) NOT NULL,
    template_type VARCHAR(50) NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES users(user_id) ON DELETE CASCADE
);

-- 创建账单表
CREATE TABLE bill_lists (
    bill_list_id SERIAL PRIMARY KEY,
    bill_name VARCHAR(100) NOT NULL,
    template_id INTEGER,
    user_id INTEGER NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (template_id) REFERENCES templates(template_id) ON DELETE SET NULL,
    FOREIGN KEY (user_id) REFERENCES users(user_id) ON DELETE CASCADE
);

-- 创建记账表
CREATE TABLE bill_items (
    bill_item_id SERIAL PRIMARY KEY,
    bill_list_id INTEGER NOT NULL,
    type VARCHAR(20) NOT NULL CHECK (type IN ('收入', '支出')),
    payment_method VARCHAR(20) NOT NULL CHECK (payment_method IN ('支付宝', '微信', '银行卡', '现金', '其他')),
    transaction_time DATE NOT NULL,
    amount DECIMAL(10, 2) NOT NULL,
    category VARCHAR(50) NOT NULL CHECK (category IN ('餐饮', '交通','医疗','其他','工资', '奖金', '投资')),
    notes TEXT,
    last_updated TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (bill_list_id) REFERENCES bill_lists(bill_list_id) ON DELETE CASCADE
);

-- 创建索引以提高查询性能
CREATE INDEX idx_users_username ON users(username);
CREATE INDEX idx_templates_user_id ON templates(user_id);
CREATE INDEX idx_bill_lists_user_id ON bill_lists(user_id);
CREATE INDEX idx_bill_lists_template_id ON bill_lists(template_id);
CREATE INDEX idx_bill_items_bill_list_id ON bill_items(bill_list_id);
CREATE INDEX idx_bill_items_transaction_time ON bill_items(transaction_time);
CREATE INDEX idx_bill_items_category ON bill_items(category);